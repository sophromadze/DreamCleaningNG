<div class="admin-container">
    <h1>Admin Panel</h1>
    
    <!-- Permissions Info Card -->
    <div class="permissions-card" *ngIf="userRole">
      <div class="permissions-header">
        <h6>Your Role: 
          <span class="role-badge" 
                [ngClass]="{
                  'superadmin': userRole === 'SuperAdmin',
                  'admin': userRole === 'Admin',
                  'moderator': userRole === 'Moderator'
                }">
            {{ userRole }}
          </span>
        </h6>
      </div>
      <div class="permissions-grid">
        <div class="permission-item" [class.active]="userPermissions?.canView">
          <span class="icon">üëÅÔ∏è</span>
          <span class="label">View</span>
        </div>
        <div class="permission-item" [class.active]="userPermissions?.canCreate">
          <span class="icon">‚ûï</span>
          <span class="label">Create</span>
        </div>
        <div class="permission-item" [class.active]="userPermissions?.canUpdate">
          <span class="icon">‚úèÔ∏è</span>
          <span class="label">Update</span>
        </div>
        <div class="permission-item" [class.active]="userPermissions?.canDelete">
          <span class="icon">üóëÔ∏è</span>
          <span class="label">Delete</span>
        </div>
        <div class="permission-item" [class.active]="userPermissions?.canActivate">
          <span class="icon">‚úÖ</span>
          <span class="label">Activate</span>
        </div>
        <div class="permission-item" [class.active]="userPermissions?.canDeactivate">
          <span class="icon">üö´</span>
          <span class="label">Deactivate</span>
        </div>
      </div>
    </div>
    
    <!-- Tab Navigation -->
    <div class="admin-tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'services'"
        (click)="switchTab('services')">
        Booking Services
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'users'"
        (click)="switchTab('users')">
        User Info
      </button>
    </div>
  
    <!-- Messages -->
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
  
    <!-- Booking Services Tab -->
    <div class="tab-content" *ngIf="activeTab === 'services'">
      <div class="services-layout">
        <!-- Service Types Section -->
        <div class="service-types-section">
          <div class="section-header">
            <h2>Service Types</h2>
            <button class="add-btn" *ngIf="canCreate" (click)="startAddingServiceType()">Add New</button>
          </div>
  
          <!-- Add Service Type Form -->
          <div class="service-type-form" *ngIf="isAddingServiceType">
            <h3>Add New Service Type</h3>
            <div class="form-group">
              <label>Name</label>
              <input type="text" [(ngModel)]="newServiceType.name" placeholder="e.g., Residential Cleaning">
            </div>
            <div class="form-group">
              <label>Base Price</label>
              <input type="number" [(ngModel)]="newServiceType.basePrice" placeholder="120">
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea [(ngModel)]="newServiceType.description" rows="3"></textarea>
            </div>
            <div class="form-actions">
              <button class="save-btn" (click)="addServiceType()">Create</button>
              <button class="cancel-btn" (click)="cancelAddServiceType()">Cancel</button>
            </div>
          </div>
  
          <div class="service-types-list">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Base Price</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th *ngIf="userRole !== 'Moderator'">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let type of serviceTypes" [class.selected]="selectedServiceType?.id === type.id" (click)="selectServiceType(type)">
                  <td>{{ type.id }}</td>
                  <td>{{ type.name }}</td>
                  <td>${{ type.basePrice }}</td>
                  <td>{{ type.description || 'No description' }}</td>
                  <td>
                    <span class="status-badge" [class.active]="type.isActive" [class.inactive]="!type.isActive">
                      {{ type.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td *ngIf="userRole !== 'Moderator'">
                    <button class="action-btn edit" *ngIf="canUpdate" (click)="selectServiceType(type); editServiceType(); $event.stopPropagation()">Edit</button>
                    <button class="action-btn activate" *ngIf="canActivate && !type.isActive" (click)="activateServiceType(type); $event.stopPropagation()">Activate</button>
                    <button class="action-btn deactivate" *ngIf="canDeactivate && type.isActive" (click)="deactivateServiceType(type); $event.stopPropagation()">Deactivate</button>
                    <button class="action-btn delete" *ngIf="canDelete" (click)="deleteServiceType(type); $event.stopPropagation()">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
  
        <!-- Service Type Details -->
        <div class="service-details-section" *ngIf="selectedServiceType">
          <div class="service-type-form" *ngIf="isEditingServiceType">
            <div class="form-group">
              <label>Name</label>
              <input type="text" [(ngModel)]="selectedServiceType.name">
            </div>
            <div class="form-group">
              <label>Base Price</label>
              <input type="number" [(ngModel)]="selectedServiceType.basePrice">
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea [(ngModel)]="selectedServiceType.description" rows="3"></textarea>
            </div>
            <div class="form-actions">
              <button class="save-btn" (click)="saveServiceType()">Save</button>
              <button class="cancel-btn" (click)="cancelEditServiceType()">Cancel</button>
            </div>
          </div>
  
          <!-- Services Section -->
          <div class="services-subsection">
            <div class="section-header">
              <h3>Services</h3>
              <button class="add-btn" *ngIf="canCreate" (click)="startAddingService()">Add Service</button>
            </div>
  
            <!-- Add Service Form -->
            <div class="service-form" *ngIf="isAddingService">
              <h4>Add New Service</h4>
              
              <!-- Option to copy existing service -->
              <div class="copy-option">
                <label>
                  <input type="checkbox" [(ngModel)]="showExistingServices">
                  Copy from existing service
                </label>
                
                <div *ngIf="showExistingServices" class="existing-services-select">
                  <select [(ngModel)]="selectedExistingServiceId">
                    <option value="">Select a service to copy</option>
                    <option *ngFor="let service of allServices" [value]="service.id">
                      {{ service.name }} ({{ getServiceTypeNameById(service.serviceTypeId) }})
                    </option>
                  </select>
                  <button class="copy-btn" (click)="copyExistingService()" [disabled]="!selectedExistingServiceId">
                    Copy Service
                  </button>
                </div>
              </div>
              
              <div *ngIf="!showExistingServices" class="form-grid">
                <div class="form-group">
                  <label>Name</label>
                  <input type="text" [(ngModel)]="newService.name" placeholder="e.g., Bedrooms">
                </div>
                <div class="form-group">
                  <label>Service Key</label>
                  <input type="text" [(ngModel)]="newService.serviceKey" placeholder="e.g., bedrooms">
                </div>
                <div class="form-group">
                  <label>Cost</label>
                  <input type="number" [(ngModel)]="newService.cost" step="0.01">
                </div>
                <div class="form-group">
                  <label>Duration (minutes)</label>
                  <input type="number" [(ngModel)]="newService.timeDuration">
                </div>
                <div class="form-group">
                  <label>Input Type</label>
                  <select [(ngModel)]="newService.inputType">
                    <option value="dropdown">Dropdown</option>
                    <option value="slider">Slider</option>
                    <option value="number">Number</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Min Value</label>
                  <input type="number" [(ngModel)]="newService.minValue">
                </div>
                <div class="form-group">
                  <label>Max Value</label>
                  <input type="number" [(ngModel)]="newService.maxValue">
                </div>
                <div class="form-group">
                  <label>Step Value</label>
                  <input type="number" [(ngModel)]="newService.stepValue">
                </div>
                <div class="form-group">
                  <label>Unit</label>
                  <input type="text" [(ngModel)]="newService.unit" placeholder="e.g., per hour">
                </div>
                <div class="form-group">
                  <label>Service Type</label>
                  <select [(ngModel)]="newService.serviceRelationType">
                    <option value="">Regular Service</option>
                    <option value="cleaner">Cleaner Service</option>
                    <option value="hours">Hours for Cleaners</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>
                    <input type="checkbox" [(ngModel)]="newService.isRangeInput">
                    Is Range Input
                  </label>
                </div>
              </div>
              <div class="form-actions">
                <button class="save-btn" (click)="addService()" *ngIf="!showExistingServices">Create</button>
                <button class="cancel-btn" (click)="cancelAddService()">Cancel</button>
              </div>
            </div>
  
            <!-- Services List -->
            <div class="services-list">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Service Key</th>
                    <th>Cost</th>
                    <th>Duration</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th *ngIf="userRole !== 'Moderator'">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let service of selectedServiceType.services">
                    <td *ngIf="editingServiceId !== service.id">{{ service.id }}</td>
                    <td *ngIf="editingServiceId !== service.id">{{ service.name }}</td>
                    <td *ngIf="editingServiceId !== service.id">{{ service.serviceKey }}</td>
                    <td *ngIf="editingServiceId !== service.id">${{ service.cost }}</td>
                    <td *ngIf="editingServiceId !== service.id">{{ service.timeDuration }}min</td>
                    <td *ngIf="editingServiceId !== service.id">{{ service.inputType }}</td>
                    <td *ngIf="editingServiceId !== service.id">
                      <span class="status-badge" [class.active]="service.isActive" [class.inactive]="!service.isActive">
                        {{ service.isActive ? 'Active' : 'Inactive' }}
                      </span>
                    </td>
                    <td *ngIf="editingServiceId !== service.id && userRole !== 'Moderator'">
                      <button class="action-btn edit" *ngIf="canUpdate" (click)="editService(service); $event.stopPropagation()">Edit</button>
                      <button class="action-btn activate" *ngIf="canActivate && !service.isActive" (click)="activateService(service); $event.stopPropagation()">Activate</button>
                      <button class="action-btn deactivate" *ngIf="canDeactivate && service.isActive" (click)="deactivateService(service); $event.stopPropagation()">Deactivate</button>
                      <button class="action-btn delete" *ngIf="canDelete" (click)="deleteService(service); $event.stopPropagation()">Delete</button>
                    </td>
                    
                    <!-- Edit mode -->
                    <td class="edit-mode-td" colspan="8" *ngIf="editingServiceId === service.id">
                      <div class="inline-edit-form">
                        <div class="form-row">
                          <div class="form-group">
                            <label>Name</label>
                            <input type="text" [(ngModel)]="service.name">
                          </div>
                          <div class="form-group">
                            <label>Service Key</label>
                            <input type="text" [(ngModel)]="service.serviceKey">
                          </div>
                          <div class="form-group">
                            <label>Cost</label>
                            <input type="number" [(ngModel)]="service.cost" step="0.01">
                          </div>
                          <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" [(ngModel)]="service.timeDuration">
                          </div>
                        </div>
                        <div class="form-row">
                          <div class="form-group">
                            <label>Input Type</label>
                            <select [(ngModel)]="service.inputType">
                              <option value="dropdown">Dropdown</option>
                              <option value="slider">Slider</option>
                              <option value="number">Number</option>
                            </select>
                          </div>
                          <div class="form-group">
                            <label>Min Value</label>
                            <input type="number" [(ngModel)]="service.minValue">
                          </div>
                          <div class="form-group">
                            <label>Max Value</label>
                            <input type="number" [(ngModel)]="service.maxValue">
                          </div>
                          <div class="form-group">
                            <label>Step Value</label>
                            <input type="number" [(ngModel)]="service.stepValue">
                          </div>
                        </div>
                        <div class="form-actions">
                          <button class="save-btn" (click)="saveService(service)">Save</button>
                          <button class="cancel-btn" (click)="cancelEditService()">Cancel</button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
  
          <!-- Extra Services Section -->
          <div class="extra-services-subsection">
            <div class="section-header">
              <h3>Extra Services</h3>
              <button class="add-btn" *ngIf="canCreate" (click)="startAddingExtraService()">Add Extra Service</button>
            </div>
  
            <!-- Add Extra Service Form -->
            <div class="service-form" *ngIf="isAddingExtraService">
              <h4>Add New Extra Service</h4>
              
              <!-- Option to copy existing extra service -->
              <div class="copy-option">
                <label>
                  <input type="checkbox" [(ngModel)]="showExistingExtraServices">
                  Copy from existing extra service
                </label>
                
                <div *ngIf="showExistingExtraServices" class="existing-services-select">
                  <select [(ngModel)]="selectedExistingExtraServiceId">
                    <option value="">Select an extra service to copy</option>
                    <option *ngFor="let extra of allExtraServices" [value]="extra.id">
                      {{ extra.name }} ({{ extra.isAvailableForAll ? 'Universal' : 'Service-specific' }})
                    </option>
                  </select>
                  <button class="copy-btn" (click)="copyExistingExtraService()" [disabled]="!selectedExistingExtraServiceId">
                    Copy Extra Service
                  </button>
                </div>
              </div>
              
              <div *ngIf="!showExistingExtraServices" class="form-grid">
                <div class="form-group">
                  <label>Name</label>
                  <input type="text" [(ngModel)]="newExtraService.name">
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <input type="text" [(ngModel)]="newExtraService.description">
                </div>
                <div class="form-group">
                  <label>Price</label>
                  <input type="number" [(ngModel)]="newExtraService.price" step="0.01">
                </div>
                <div class="form-group">
                  <label>Duration (minutes)</label>
                  <input type="number" [(ngModel)]="newExtraService.duration">
                </div>
                <div class="form-group">
                  <label>Price Multiplier</label>
                  <input type="number" [(ngModel)]="newExtraService.priceMultiplier" step="0.1">
                </div>
                <div class="form-group">
                  <label>Icon</label>
                  <input type="text" [(ngModel)]="newExtraService.icon">
                </div>
                <div class="form-group full-width">
                  <label>Options</label>
                  <div class="checkbox-group">
                    <label>
                      <input type="checkbox" [(ngModel)]="newExtraService.hasQuantity">
                      Has Quantity
                    </label>
                    <label>
                      <input type="checkbox" [(ngModel)]="newExtraService.hasHours">
                      Has Hours
                    </label>
                    <label>
                      <input type="checkbox" [(ngModel)]="newExtraService.isDeepCleaning">
                      Is Deep Cleaning
                    </label>
                    <label>
                      <input type="checkbox" [(ngModel)]="newExtraService.isSuperDeepCleaning">
                      Is Super Deep Cleaning
                    </label>
                    <label>
                      <input type="checkbox" [(ngModel)]="newExtraService.isSameDayService">
                      Is Same Day Service
                    </label>
                    <label>
                      <input type="checkbox" [(ngModel)]="newExtraService.isAvailableForAll">
                      Available for All Service Types
                    </label>
                  </div>
                  <p class="form-note" *ngIf="newExtraService.isAvailableForAll">
                    <strong>Note:</strong> When checked, this extra service will be available for all service types.
                  </p>
                </div>
              </div>
              <div class="form-actions">
                <button class="save-btn" (click)="addExtraService()" *ngIf="!showExistingExtraServices">Create</button>
                <button class="cancel-btn" (click)="cancelAddExtraService()">Cancel</button>
              </div>
            </div>
  
            <!-- Extra Services List -->
            <div class="extra-services-list">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Duration</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th *ngIf="userRole !== 'Moderator'">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let extra of selectedServiceType.extraServices">
                    <td *ngIf="editingExtraServiceId !== extra.id">{{ extra.id }}</td>
                    <td *ngIf="editingExtraServiceId !== extra.id">{{ extra.name }}</td>
                    <td *ngIf="editingExtraServiceId !== extra.id">{{ extra.description || 'No description' }}</td>
                    <td *ngIf="editingExtraServiceId !== extra.id">${{ extra.price }}</td>
                    <td *ngIf="editingExtraServiceId !== extra.id">{{ extra.duration }}min</td>
                    <td *ngIf="editingExtraServiceId !== extra.id">
                      <span class="universal-badge" *ngIf="extra.isAvailableForAll">Universal</span>
                      <span class="service-specific-badge" *ngIf="!extra.isAvailableForAll">Service-specific</span>
                    </td>
                    <td *ngIf="editingExtraServiceId !== extra.id">
                      <span class="status-badge" [class.active]="extra.isActive" [class.inactive]="!extra.isActive">
                        {{ extra.isActive ? 'Active' : 'Inactive' }}
                      </span>
                    </td>
                    <td *ngIf="editingExtraServiceId !== extra.id && userRole !== 'Moderator'">
                      <button class="action-btn edit" *ngIf="canUpdate" (click)="editExtraService(extra); $event.stopPropagation()">Edit</button>
                      <button class="action-btn activate" *ngIf="canActivate && !extra.isActive" (click)="activateExtraService(extra); $event.stopPropagation()">Activate</button>
                      <button class="action-btn deactivate" *ngIf="canDeactivate && extra.isActive" (click)="deactivateExtraService(extra); $event.stopPropagation()">Deactivate</button>
                      <button class="action-btn delete" *ngIf="canDelete" (click)="deleteExtraService(extra); $event.stopPropagation()">Delete</button>
                    </td>
                    
                    <!-- Edit mode -->
                    <td class="edit-mode-td" colspan="8" *ngIf="editingExtraServiceId === extra.id">
                      <div class="inline-edit-form">
                        <div class="form-row">
                          <div class="form-group">
                            <label>Name</label>
                            <input type="text" [(ngModel)]="extra.name">
                          </div>
                          <div class="form-group">
                            <label>Description</label>
                            <input type="text" [(ngModel)]="extra.description">
                          </div>
                          <div class="form-group">
                            <label>Price</label>
                            <input type="number" [(ngModel)]="extra.price" step="0.01">
                          </div>
                          <div class="form-group">
                            <label>Duration (minutes)</label>
                            <input type="number" [(ngModel)]="extra.duration">
                          </div>
                        </div>
                        <div class="form-row">
                          <div class="form-group">
                            <label>Price Multiplier</label>
                            <input type="number" [(ngModel)]="extra.priceMultiplier" step="0.1">
                          </div>
                          <div class="form-group">
                            <label>Icon</label>
                            <input type="text" [(ngModel)]="extra.icon">
                          </div>
                          <div class="form-group full-width">
                            <label>Options</label>
                            <div class="checkbox-group">
                              <label>
                                <input type="checkbox" [(ngModel)]="extra.hasQuantity">
                                Has Quantity
                              </label>
                              <label>
                                <input type="checkbox" [(ngModel)]="extra.hasHours">
                                Has Hours
                              </label>
                              <label>
                                <input type="checkbox" [(ngModel)]="extra.isDeepCleaning">
                                Is Deep Cleaning
                              </label>
                              <label>
                                <input type="checkbox" [(ngModel)]="extra.isSuperDeepCleaning">
                                Is Super Deep Cleaning
                              </label>
                              <label>
                                <input type="checkbox" [(ngModel)]="extra.isSameDayService">
                                Is Same Day Service
                              </label>
                              <label>
                                <input type="checkbox" [(ngModel)]="extra.isAvailableForAll">
                                Available for All Service Types
                              </label>
                            </div>
                          </div>
                        </div>
                        <div class="form-actions">
                          <button class="save-btn" (click)="saveExtraService(extra)">Save</button>
                          <button class="cancel-btn" (click)="cancelEditExtraService()">Cancel</button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Subscriptions Section -->
      <div class="subscriptions-section">
        <div class="section-header">
          <h2>Subscriptions</h2>
          <button class="add-btn" *ngIf="canCreate" (click)="startAddingSubscription()">Add Subscription</button>
        </div>
  
        <!-- Add Subscription Form -->
        <div class="subscription-form" *ngIf="isAddingSubscription">
          <h3>Create New Subscription</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Name</label>
              <input type="text" [(ngModel)]="newSubscription.name" placeholder="e.g., Weekly">
            </div>
            <div class="form-group">
              <label>Description</label>
              <input type="text" [(ngModel)]="newSubscription.description">
            </div>
            <div class="form-group">
              <label>Discount Percentage</label>
              <input type="number" [(ngModel)]="newSubscription.discountPercentage" min="0" max="100">
            </div>
            <div class="form-group">
              <label>Subscription Days</label>
              <input type="number" [(ngModel)]="newSubscription.subscriptionDays" min="0">
            </div>
          </div>
          <div class="form-actions">
            <button class="save-btn" (click)="addSubscription()">Create</button>
            <button class="cancel-btn" (click)="cancelAddSubscription()">Cancel</button>
          </div>
        </div>
  
        <!-- Subscriptions List -->
        <div class="subscriptions-list">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Discount</th>
                <th>Days</th>
                <th>Status</th>
                <th *ngIf="userRole !== 'Moderator'">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let subscription of subscriptions">
                <td *ngIf="editingSubscriptionId !== subscription.id">{{ subscription.id }}</td>
                <td *ngIf="editingSubscriptionId !== subscription.id">{{ subscription.name }}</td>
                <td *ngIf="editingSubscriptionId !== subscription.id">{{ subscription.description || '-' }}</td>
                <td *ngIf="editingSubscriptionId !== subscription.id">{{ subscription.discountPercentage }}%</td>
                <td *ngIf="editingSubscriptionId !== subscription.id">{{ subscription.subscriptionDays === 0 ? 'One Time' : subscription.subscriptionDays }}</td>
                <td *ngIf="editingSubscriptionId !== subscription.id">
                  <span class="status-badge" [class.active]="subscription.isActive" [class.inactive]="!subscription.isActive">
                    {{ subscription.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td *ngIf="editingSubscriptionId !== subscription.id && userRole !== 'Moderator'">
                  <button class="action-btn edit" *ngIf="canUpdate" (click)="editSubscription(subscription)">Edit</button>
                  <button class="action-btn activate" *ngIf="canActivate && !subscription.isActive" (click)="activateSubscription(subscription)">Activate</button>
                  <button class="action-btn deactivate" *ngIf="canDeactivate && subscription.isActive" (click)="deactivateSubscription(subscription)">Deactivate</button>
                  <button class="action-btn delete" *ngIf="canDelete" (click)="deleteSubscription(subscription)">Delete</button>
                </td>
                
                <!-- Edit mode -->
                <td class="edit-mode-td" colspan="7" *ngIf="editingSubscriptionId === subscription.id">
                  <div class="inline-edit-form">
                    <div class="form-row">
                      <div class="form-group">
                        <label>Name</label>
                        <input type="text" [(ngModel)]="subscription.name">
                      </div>
                      <div class="form-group">
                        <label>Description</label>
                        <input type="text" [(ngModel)]="subscription.description">
                      </div>
                      <div class="form-group">
                        <label>Discount %</label>
                        <input type="number" [(ngModel)]="subscription.discountPercentage" min="0" max="100">
                      </div>
                      <div class="form-group">
                        <label>Days</label>
                        <input type="number" [(ngModel)]="subscription.subscriptionDays" min="0">
                      </div>
                    </div>
                    <div class="form-actions">
                      <button class="save-btn" (click)="saveSubscription(subscription)">Save</button>
                      <button class="cancel-btn" (click)="cancelEditSubscription()">Cancel</button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
  
      <!-- Promo Codes Section -->
      <div class="promo-codes-section">
        <div class="section-header">
          <h2>Promo Codes</h2>
          <button class="add-btn" *ngIf="canCreate" (click)="startAddingPromoCode()">Add Promo Code</button>
        </div>
  
        <!-- Add Promo Code Form -->
        <div class="promo-code-form" *ngIf="isAddingPromoCode">
          <h3>Create New Promo Code</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Code <span class="required">*</span></label>
              <input type="text" 
                     [(ngModel)]="newPromoCode.code" 
                     placeholder="SUMMER20" 
                     maxlength="50"
                     required>
            </div>
            <div class="form-group">
              <label>Description</label>
              <input type="text" 
                     [(ngModel)]="newPromoCode.description" 
                     maxlength="200">
            </div>
            <div class="form-group">
              <label>Discount Type <span class="required">*</span></label>
              <select [(ngModel)]="newPromoCode.isPercentage">
                <option [ngValue]="true">Percentage</option>
                <option [ngValue]="false">Fixed Amount</option>
              </select>
            </div>
            <div class="form-group">
              <label>Discount Value <span class="required">*</span></label>
              <input type="number" 
                     [(ngModel)]="newPromoCode.discountValue" 
                     min="0.01" 
                     [max]="newPromoCode.isPercentage ? 100 : 99999" 
                     step="0.01" 
                     required>
              <small class="form-hint" *ngIf="newPromoCode.isPercentage">Maximum 100%</small>
            </div>
            <div class="form-group">
              <label>Max Usage Count</label>
              <input type="number" 
                     [(ngModel)]="newPromoCode.maxUsageCount" 
                     min="1">
              <small class="form-hint">Leave empty for unlimited usage</small>
            </div>
            <div class="form-group">
              <label>Max Usage Per User</label>
              <input type="number" 
                     [(ngModel)]="newPromoCode.maxUsagePerUser" 
                     min="1"
                     [max]="newPromoCode.maxUsageCount || 999">
              <small class="form-hint">Leave empty for unlimited usage per user</small>
            </div>
            <div class="form-group">
              <label>Valid From</label>
              <input type="date" [(ngModel)]="newPromoCode.validFrom">
              <small class="form-hint">Leave empty to start immediately</small>
            </div>
            <div class="form-group">
              <label>Valid To</label>
              <input type="date" 
                     [(ngModel)]="newPromoCode.validTo"
                     [min]="newPromoCode.validFrom || ''">
              <small class="form-hint">Leave empty for no expiration</small>
            </div>
            <div class="form-group">
              <label>Minimum Order Amount</label>
              <input type="number" 
                     [(ngModel)]="newPromoCode.minimumOrderAmount" 
                     min="0.01" 
                     step="0.01">
              <small class="form-hint">Leave empty for no minimum</small>
            </div>
          </div>
          <div class="form-actions">
            <button class="save-btn" 
                    (click)="addPromoCode()" 
                    [disabled]="!newPromoCode.code || newPromoCode.discountValue <= 0">
              Create
            </button>
            <button class="cancel-btn" (click)="cancelAddPromoCode()">Cancel</button>
          </div>
        </div>
  
        <!-- Promo Codes List -->
        <div class="promo-codes-list">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Code</th>
                <th>Description</th>
                <th>Discount</th>
                <th>Usage</th>
                <th>Valid From</th>
                <th>Valid To</th>
                <th>Status</th>
                <th *ngIf="userRole !== 'Moderator'">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let promo of promoCodes">
                <td *ngIf="editingPromoCodeId !== promo.id">{{ promo.id }}</td>
                <td *ngIf="editingPromoCodeId !== promo.id">{{ promo.code }}</td>
                <td *ngIf="editingPromoCodeId !== promo.id">{{ promo.description || '-' }}</td>
                <td *ngIf="editingPromoCodeId !== promo.id">
                  {{ promo.isPercentage ? promo.discountValue + '%' : '$' + promo.discountValue }}
                </td>
                <td *ngIf="editingPromoCodeId !== promo.id">
                  {{ promo.currentUsageCount }}{{ promo.maxUsageCount ? '/' + promo.maxUsageCount : '' }}
                </td>
                <td *ngIf="editingPromoCodeId !== promo.id">{{ promo.validFrom ? (promo.validFrom | date) : '-' }}</td>
                <td *ngIf="editingPromoCodeId !== promo.id">{{ promo.validTo ? (promo.validTo | date) : '-' }}</td>
                <td *ngIf="editingPromoCodeId !== promo.id">
                  <span class="status" [class.active]="promo.isActive" [class.inactive]="!promo.isActive">
                    {{ promo.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </td>
                <td *ngIf="editingPromoCodeId !== promo.id && userRole !== 'Moderator'">
                  <button class="action-btn edit" *ngIf="canUpdate" (click)="editPromoCode(promo)">Edit</button>
                  <button class="action-btn activate" *ngIf="canActivate && !promo.isActive" (click)="activatePromoCode(promo)">Activate</button>
                  <button class="action-btn deactivate" *ngIf="canDeactivate && promo.isActive" (click)="deactivatePromoCode(promo)">Deactivate</button>
                  <button class="action-btn delete" *ngIf="canDelete" (click)="deletePromoCode(promo)">Delete</button>
                </td>
                
                <!-- Edit mode -->
                <td class="edit-mode-td" colspan="9" *ngIf="editingPromoCodeId === promo.id">
                  <div class="inline-edit-form expanded">
                    <div class="form-row">
                      <div class="form-group">
                        <label>Description</label>
                        <input type="text" [(ngModel)]="promo.description" maxlength="200">
                      </div>
                      <div class="form-group">
                        <label>Type <span class="required">*</span></label>
                        <select [(ngModel)]="promo.isPercentage">
                          <option [ngValue]="true">Percentage</option>
                          <option [ngValue]="false">Fixed Amount</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label>Value <span class="required">*</span></label>
                        <input type="number" 
                               [(ngModel)]="promo.discountValue" 
                               min="0.01" 
                               [max]="promo.isPercentage ? 100 : 99999" 
                               step="0.01">
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label>Max Usage Count</label>
                        <input type="number" [(ngModel)]="promo.maxUsageCount" min="1">
                      </div>
                      <div class="form-group">
                        <label>Max Usage Per User</label>
                        <input type="number" 
                               [(ngModel)]="promo.maxUsagePerUser" 
                               min="1"
                               [max]="promo.maxUsageCount || 999">
                      </div>
                      <div class="form-group">
                        <label>Minimum Order Amount</label>
                        <input type="number" [(ngModel)]="promo.minimumOrderAmount" min="0.01" step="0.01">
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label>Valid From</label>
                        <input type="date" [(ngModel)]="promo.validFrom">
                      </div>
                      <div class="form-group">
                        <label>Valid To</label>
                        <input type="date" 
                               [(ngModel)]="promo.validTo"
                               [min]="promo.validFrom || ''">
                      </div>
                      <div class="form-group">
                        <label>Active</label>
                        <select [(ngModel)]="promo.isActive">
                          <option [ngValue]="true">Yes</option>
                          <option [ngValue]="false">No</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-actions">
                      <button class="save-btn" (click)="savePromoCode(promo)" [disabled]="promo.discountValue <= 0">Save</button>
                      <button class="cancel-btn" (click)="cancelEditPromoCode()">Cancel</button>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  
    <!-- Users Tab -->
    <div class="tab-content" *ngIf="activeTab === 'users'">
      <div class="users-section">
        <h2>User Management</h2>

        <div class="users-list">
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Role</th>
                  <th>Provider</th>
                  <th>Subscription</th>
                  <th>First Time</th>
                  <th>Status</th>
                  <th *ngIf="userRole !== 'Moderator'">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users">
                  <td>{{ user.id }}</td>
                  <td>{{ user.firstName }} {{ user.lastName }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ user.phone || 'N/A' }}</td>
                  <td>
                    <span class="role-badge" 
                          [class.superadmin]="user.role === 'SuperAdmin'"
                          [class.admin]="user.role === 'Admin'"
                          [class.moderator]="user.role === 'Moderator'"
                          [class.customer]="user.role === 'Customer'">
                      {{ user.role }}
                    </span>
                  </td>
                  <td>{{ user.authProvider || 'Local' }}</td>
                  <td>{{ user.subscriptionName || 'None' }}</td>
                  <td>
                    <span class="badge" [class.bg-success]="user.firstTimeOrder" [class.bg-secondary]="!user.firstTimeOrder">
                      {{ user.firstTimeOrder ? 'Yes' : 'No' }}
                    </span>
                  </td>
                  <td>
                    <span class="status-badge" 
                          [class.active]="user.isActive" 
                          [class.inactive]="!user.isActive">
                      {{ user.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td *ngIf="userRole !== 'Moderator'">
                    <!-- Status Actions -->
                    <button class="action-btn deactivate" 
                            *ngIf="canDeactivate && user.isActive" 
                            (click)="updateUserStatus(user, false)">
                      Deactivate
                    </button>
                    <button class="action-btn activate" 
                            *ngIf="canActivate && !user.isActive" 
                            (click)="updateUserStatus(user, true)">
                      Activate
                    </button>

                    <!-- Role Change Dropdown -->
                    <div class="role-dropdown" *ngIf="canUpdate">
                      <button class="dropdown-toggle" 
                              [disabled]="currentUserRole === 'Admin' && user.role === 'SuperAdmin'"
                              (click)="toggleRoleDropdown(user.id)">
                        Change Role
                        <span class="chevron">‚ñº</span>
                      </button>
                      <div class="dropdown-menu" *ngIf="roleDropdownUserId === user.id">
                        <a class="dropdown-item" 
                           [class.disabled]="!canChangeUserRole(user, 'Customer')"
                           (click)="canChangeUserRole(user, 'Customer') && updateUserRole(user, 'Customer')">
                          Customer
                        </a>
                        <a class="dropdown-item" 
                           [class.disabled]="!canChangeUserRole(user, 'Moderator')"
                           (click)="canChangeUserRole(user, 'Moderator') && updateUserRole(user, 'Moderator')">
                          Moderator
                        </a>
                        <a class="dropdown-item" 
                           [class.disabled]="!canChangeUserRole(user, 'Admin')"
                           (click)="canChangeUserRole(user, 'Admin') && updateUserRole(user, 'Admin')">
                          Admin
                        </a>
                        <a class="dropdown-item" 
                           *ngIf="currentUserRole === 'SuperAdmin'"
                           [class.disabled]="!canChangeUserRole(user, 'SuperAdmin')"
                           (click)="canChangeUserRole(user, 'SuperAdmin') && updateUserRole(user, 'SuperAdmin')">
                          SuperAdmin
                        </a>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>